# Environment Variables Setup Guide

## Quick Reference

| Variable | Where to Get | Required For |
|----------|--------------|--------------|
| `PM_WALLET_KEY` | Auto-generated by setup script | Gas for wallet pool |
| `HYPEREVM_MASTER_WALLET` | Same as PM (auto) | Receiving USDH |
| `NEXT_PUBLIC_PRIVY_APP_ID` | [Privy Dashboard](https://dashboard.privy.io) | User authentication |
| `PRIVY_APP_SECRET` | [Privy Dashboard](https://dashboard.privy.io) | Server auth |
| `WALLET_ENCRYPTION_KEY` | Generate yourself | Encrypting wallet keys |
| `DATABASE_URL` | [Vercel Dashboard](https://vercel.com) | Database connection |
| `ADMIN_AUTH_TOKEN` | Generate yourself | Admin API protection |

---

## üîê Required Variables (Production)

### 1. Wallet & Blockchain

```bash
# PM Wallet (Relayer) - Auto-generated by setup script
# Or use existing wallet private key
PM_WALLET_KEY=0x...
HYPEREVM_MASTER_KEY=0x...  # Same as PM_WALLET_KEY (or different)
HYPEREVM_MASTER_WALLET=0x...  # Public address

# USDH Contract (HyperEVM mainnet)
USDH_CONTRACT_ADDRESS=0x94e...  # Get from HyperLiquid docs

# Database
DATABASE_URL="postgresql://..."
```

### 2. Privy Authentication

Get from [Privy Dashboard](https://dashboard.privy.io):

```bash
# Client-side (exposed to browser)
NEXT_PUBLIC_PRIVY_APP_ID=cm-your-app-id

# Server-side (secret)
PRIVY_APP_ID=cm-your-app-id
PRIVY_APP_SECRET=your-app-secret
```

### 3. Security

```bash
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
WALLET_ENCRYPTION_KEY=your-32-char-minimum-encryption-key

# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
ADMIN_AUTH_TOKEN=your-admin-api-token
```

---

## üìÅ File Locations

### Local Development: `.env.local`

```bash
# In project root: meetmatt/.env.local
# Never commit this file!

# Database
DATABASE_URL="postgresql://neondb_owner:..."

# Wallet (Generated by setup script)
PM_WALLET_KEY=0x...
HYPEREVM_MASTER_KEY=0x...
HYPEREVM_MASTER_WALLET=0x...

# Privy
NEXT_PUBLIC_PRIVY_APP_ID=cm-xxx
PRIVY_APP_ID=cm-xxx
PRIVY_APP_SECRET=xxx

# Security
WALLET_ENCRYPTION_KEY=xxx
ADMIN_AUTH_TOKEN=xxx

# USDH
USDH_CONTRACT_ADDRESS=0x...
```

### Vercel Production: Dashboard

1. Go to [Vercel Dashboard](https://vercel.com)
2. Select your project
3. Settings ‚Üí Environment Variables
4. Add each variable:
   - **Name**: Variable name (e.g., `PM_WALLET_KEY`)
   - **Value**: The value
   - **Environment**: Production (and Preview if needed)

### Vercel CLI (Alternative)

```bash
# Add one by one
vercel env add PM_WALLET_KEY production
vercel env add PRIVY_APP_SECRET production
# ... etc

# Or pull from local .env.local
vercel env pull
```

---

## üîë Privy Setup Steps

### 1. Create Privy Account

1. Go to [dashboard.privy.io](https://dashboard.privy.io)
2. Sign up with email or wallet
3. Click "Create new app"
4. Name it "Meet Matt"
5. Select "Web" platform

### 2. Get App Credentials

In your Privy app dashboard:

**App ID** (starts with `cm-`):
```
Settings ‚Üí App ID ‚Üí Copy
```

**App Secret**:
```
Settings ‚Üí App Secrets ‚Üí Create Secret ‚Üí Copy
‚ö†Ô∏è  This is shown ONCE - save it immediately!
```

### 3. Configure Login Methods

In Privy dashboard, enable:
- ‚úÖ **Email** (OTP)
- ‚úÖ **Google**
- ‚úÖ **Twitter**
- ‚úÖ **Discord** (optional)
- ‚úÖ **Wallets** (MetaMask, Rainbow, etc.)

### 4. Configure Embedded Wallets

```
Embedded Wallets ‚Üí Settings
- Creation: "On login (for users without a wallet)"
- Recovery: "User's login method"
```

### 5. Add Custom Chain (HyperEVM)

```
Chains ‚Üí Custom Chains
- Name: HyperEVM
- Chain ID: 998
- RPC URL: https://rpc.hyperliquid.xyz/evm
- Currency: HYPER
- Explorer: https://purrsec.com
```

### 6. Copy to Environment

```bash
# .env.local
NEXT_PUBLIC_PRIVY_APP_ID=cm-your-app-id
PRIVY_APP_ID=cm-your-app-id
PRIVY_APP_SECRET=your-secret-key
```

---

## üõ°Ô∏è Security Best Practices

### NEVER Do This:

‚ùå Commit `.env.local` to git:
```bash
# This is BAD!
git add .env.local
git commit -m "add env"
```

‚ùå Share private keys in Slack/Discord:
```
PM_WALLET_KEY=0xabc123...  # Don't share this!
```

‚ùå Use same key for dev and production

### ALWAYS Do This:

‚úÖ Add to `.gitignore`:
```
.env.local
.env*.local
```

‚úÖ Use different keys for dev/staging/prod

‚úÖ Restrict Vercel env vars to specific environments

‚úÖ Rotate keys if compromised

‚úÖ Use strong encryption keys (32+ random bytes)

---

## üöÄ Complete Setup Commands

```bash
# 1. Clone repo
git clone <repo>
cd meetmatt

# 2. Install dependencies
npm install

# 3. Run setup script (generates PM wallet)
npx tsx scripts/setup-wallets.ts

# 4. Add Privy credentials to .env.local
# (Get from dashboard.privy.io)
echo "NEXT_PUBLIC_PRIVY_APP_ID=cm-xxx" >> .env.local
echo "PRIVY_APP_SECRET=xxx" >> .env.local

# 5. Add other secrets
echo "WALLET_ENCRYPTION_KEY=$(node -e "console.log(require('crypto').randomBytes(32).toString('hex'))")" >> .env.local
echo "ADMIN_AUTH_TOKEN=$(node -e "console.log(require('crypto').randomBytes(32).toString('hex'))")" >> .env.local

# 6. Fund PM wallet with HYPER
# (Transfer to address shown by setup script)

# 7. Generate burner wallets
npx tsx scripts/setup-wallets.ts 100

# 8. Run dev server
npm run dev
```

---

## üîç Troubleshooting

### "Missing environment variable"

```bash
# Check if variable is set
grep VARIABLE_NAME .env.local

# For Next.js public vars, restart dev server after changes
```

### "Invalid Privy app ID"

- Check dashboard.privy.io for correct ID
- Ensure `NEXT_PUBLIC_` prefix for client-side vars
- `PRIVY_APP_SECRET` is server-side only (no prefix)

### "Cannot decrypt wallet keys"

- `WALLET_ENCRYPTION_KEY` must be same that was used to encrypt
- Lost key = lost wallets (regenerate pool if needed)

---

## üìã Checklist Before Production

- [ ] `.env.local` in `.gitignore`
- [ ] PM wallet funded with HYPER
- [ ] 100+ burner wallets generated
- [ ] Privy app created and configured
- [ ] All env vars added to Vercel
- [ ] `ADMIN_AUTH_TOKEN` is strong (64+ chars)
- [ ] `WALLET_ENCRYPTION_KEY` backed up securely
- [ ] Test payment flow on staging
- [ ] Test user login with Privy
